import { ShexJStringTransformer } from "./ShexJSimplifier";
import { jsonld2graphobject } from "jsonld2graphobject";
import { activityPub, circular, profile, simple } from "./testShapes";

// Wow, these a crappy tests
describe("ShexJ Integration", () => {
  it("works with a simple use case", async () => {
    const result = await ShexJStringTransformer.transform(
      await jsonld2graphobject({ "@id": "SCHEMA", ...simple }, "SCHEMA"),
      "Schema",
      undefined
    );
    expect(JSON.stringify(result)).toBe(
      '{"shapes":[{"id":"http://shex.io/webapps/shex.js/doc/EmployeeShape","expression":{"expressions":[{"predicate":"http://xmlns.com/foaf/0.1/givenName","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":1,"max":-1},{"predicate":"http://xmlns.com/foaf/0.1/familyName","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"}},{"predicate":"http://xmlns.com/foaf/0.1/phone","valueExpr":{},"min":0,"max":-1},{"predicate":"http://xmlns.com/foaf/0.1/mbox","valueExpr":{}}]}}]}'
    );
  });

  it("works with a circular use case", async () => {
    await ShexJStringTransformer.transform(
      await jsonld2graphobject({ "@id": "SCHEMA", ...circular }, "SCHEMA"),
      "Schema",
      undefined
    );
    // Expect not to error
    expect(true).toBe(true);
  });

  it("works with a Solid Proifle", async () => {
    const result = await ShexJStringTransformer.transform(
      await jsonld2graphobject({ "@id": "SCHEMA", ...profile }, "SCHEMA"),
      "Schema",
      undefined
    );
    expect(JSON.stringify(result)).toBe(
      '{"shapes":[{"id":"https://shaperepo.com/schemas/solidProfile#AddressShape","expression":{"expressions":[{"predicate":"http://www.w3.org/2006/vcard/ns#country-name","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The name of the user\'s country of residence"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#locality","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The name of the user\'s locality (City, Town etc.) of residence"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#postal-code","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The user\'s postal code"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#region","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The name of the user\'s region (State, Province etc.) of residence"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#street-address","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The user\'s street address"}}]}]}},{"id":"https://shaperepo.com/schemas/solidProfile#EmailShape","extra":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","expression":{"expressions":[{"predicate":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","valueExpr":{"values":["http://www.w3.org/2006/vcard/ns#Dom","http://www.w3.org/2006/vcard/ns#Home","http://www.w3.org/2006/vcard/ns#ISDN","http://www.w3.org/2006/vcard/ns#Internet","http://www.w3.org/2006/vcard/ns#Intl","http://www.w3.org/2006/vcard/ns#Label","http://www.w3.org/2006/vcard/ns#Parcel","http://www.w3.org/2006/vcard/ns#Postal","http://www.w3.org/2006/vcard/ns#Pref","http://www.w3.org/2006/vcard/ns#Work","http://www.w3.org/2006/vcard/ns#X400"]},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The type of email."}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#value","valueExpr":{},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The value of an email as a mailto link (Example <mailto:jane@example.com>)"}}]}]}},{"id":"https://shaperepo.com/schemas/solidProfile#PhoneNumberShape","extra":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","expression":{"expressions":[{"predicate":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","valueExpr":{"values":["http://www.w3.org/2006/vcard/ns#Dom","http://www.w3.org/2006/vcard/ns#Home","http://www.w3.org/2006/vcard/ns#ISDN","http://www.w3.org/2006/vcard/ns#Internet","http://www.w3.org/2006/vcard/ns#Intl","http://www.w3.org/2006/vcard/ns#Label","http://www.w3.org/2006/vcard/ns#Parcel","http://www.w3.org/2006/vcard/ns#Postal","http://www.w3.org/2006/vcard/ns#Pref","http://www.w3.org/2006/vcard/ns#Work","http://www.w3.org/2006/vcard/ns#X400"]},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"They type of Phone Number"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#value","valueExpr":{},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The value of a phone number as a tel link (Example <tel:555-555-5555>)"}}]}]}},{"id":"https://shaperepo.com/schemas/solidProfile#RSAPublicKeyShape","expression":{"expressions":[{"predicate":"http://www.w3.org/ns/auth/cert#modulus","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"RSA Modulus"}}]},{"predicate":"http://www.w3.org/ns/auth/cert#exponent","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#integer"},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"RSA Exponent"}}]}]}},{"id":"https://shaperepo.com/schemas/solidProfile#SolidProfileShape","extra":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","expression":{"expressions":[{"predicate":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","valueExpr":{"values":["http://schema.org/Person"]},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"Defines the node as a Person (from Schema.org)"}}]},{"predicate":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","valueExpr":{"values":["http://xmlns.com/foaf/0.1/Person"]},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"Defines the node as a Person (from foaf)"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#fn","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The formatted name of a person. Example: John Smith"}}]},{"predicate":"http://xmlns.com/foaf/0.1/name","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"An alternate way to define a person\'s name."}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#hasAddress","valueExpr":{"id":"https://shaperepo.com/schemas/solidProfile#AddressShape","expression":{"expressions":[{"predicate":"http://www.w3.org/2006/vcard/ns#country-name","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The name of the user\'s country of residence"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#locality","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The name of the user\'s locality (City, Town etc.) of residence"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#postal-code","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The user\'s postal code"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#region","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The name of the user\'s region (State, Province etc.) of residence"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#street-address","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The user\'s street address"}}]}]}},"min":0,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The person\'s street address."}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#hasEmail","valueExpr":{"id":"https://shaperepo.com/schemas/solidProfile#EmailShape","extra":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","expression":{"expressions":[{"predicate":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","valueExpr":{"values":["http://www.w3.org/2006/vcard/ns#Dom","http://www.w3.org/2006/vcard/ns#Home","http://www.w3.org/2006/vcard/ns#ISDN","http://www.w3.org/2006/vcard/ns#Internet","http://www.w3.org/2006/vcard/ns#Intl","http://www.w3.org/2006/vcard/ns#Label","http://www.w3.org/2006/vcard/ns#Parcel","http://www.w3.org/2006/vcard/ns#Postal","http://www.w3.org/2006/vcard/ns#Pref","http://www.w3.org/2006/vcard/ns#Work","http://www.w3.org/2006/vcard/ns#X400"]},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The type of email."}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#value","valueExpr":{},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The value of an email as a mailto link (Example <mailto:jane@example.com>)"}}]}]}},"min":0,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The person\'s email."}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#hasPhoto","valueExpr":{},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"A link to the person\'s photo"}}]},{"predicate":"http://xmlns.com/foaf/0.1/img","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"Photo link but in string form"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#hasTelephone","valueExpr":{"id":"https://shaperepo.com/schemas/solidProfile#PhoneNumberShape","extra":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","expression":{"expressions":[{"predicate":"http://www.w3.org/1999/02/22-rdf-syntax-ns#type","valueExpr":{"values":["http://www.w3.org/2006/vcard/ns#Dom","http://www.w3.org/2006/vcard/ns#Home","http://www.w3.org/2006/vcard/ns#ISDN","http://www.w3.org/2006/vcard/ns#Internet","http://www.w3.org/2006/vcard/ns#Intl","http://www.w3.org/2006/vcard/ns#Label","http://www.w3.org/2006/vcard/ns#Parcel","http://www.w3.org/2006/vcard/ns#Postal","http://www.w3.org/2006/vcard/ns#Pref","http://www.w3.org/2006/vcard/ns#Work","http://www.w3.org/2006/vcard/ns#X400"]},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"They type of Phone Number"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#value","valueExpr":{},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The value of a phone number as a tel link (Example <tel:555-555-5555>)"}}]}]}},"min":0,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"Person\'s telephone number"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#phone","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"An alternative way to define a person\'s telephone number using a string"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#organization-name","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The name of the organization with which the person is affiliated"}}]},{"predicate":"http://www.w3.org/2006/vcard/ns#role","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The name of the person\'s role in their organization"}}]},{"predicate":"http://www.w3.org/ns/auth/acl#trustedApp","valueExpr":{"id":"https://shaperepo.com/schemas/solidProfile#TrustedAppShape","expression":{"expressions":[{"predicate":"http://www.w3.org/ns/auth/acl#mode","valueExpr":{"values":["http://www.w3.org/ns/auth/acl#Append","http://www.w3.org/ns/auth/acl#Control","http://www.w3.org/ns/auth/acl#Read","http://www.w3.org/ns/auth/acl#Write"]},"min":1,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The level of access provided to this origin"}}]},{"predicate":"http://www.w3.org/ns/auth/acl#origin","valueExpr":{},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The app origin the user trusts"}}]}]}},"min":0,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"A list of app origins that are trusted by this user"}}]},{"predicate":"http://www.w3.org/ns/auth/cert#key","valueExpr":{"id":"https://shaperepo.com/schemas/solidProfile#RSAPublicKeyShape","expression":{"expressions":[{"predicate":"http://www.w3.org/ns/auth/cert#modulus","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#string"},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"RSA Modulus"}}]},{"predicate":"http://www.w3.org/ns/auth/cert#exponent","valueExpr":{"datatype":"http://www.w3.org/2001/XMLSchema#integer"},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"RSA Exponent"}}]}]}},"min":0,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"A list of RSA public keys that are associated with private keys the user holds."}}]},{"predicate":"http://www.w3.org/ns/ldp#inbox","valueExpr":{},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The user\'s LDP inbox to which apps can post notifications"}}]},{"predicate":"http://www.w3.org/ns/pim/space#preferencesFile","valueExpr":{},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The user\'s preferences"}}]},{"predicate":"http://www.w3.org/ns/pim/space#storage","valueExpr":{},"min":0,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The location of a Solid storage server related to this WebId"}}]},{"predicate":"http://www.w3.org/ns/solid/terms#account","valueExpr":{},"min":0,"max":1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The user\'s account"}}]},{"predicate":"http://www.w3.org/ns/solid/terms#privateTypeIndex","valueExpr":{},"min":0,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"A registry of all types used on the user\'s Pod (for private access only)"}}]},{"predicate":"http://www.w3.org/ns/solid/terms#publicTypeIndex","valueExpr":{},"min":0,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"A registry of all types used on the user\'s Pod (for public access)"}}]},{"predicate":"http://xmlns.com/foaf/0.1/knows","valueExpr":{},"min":0,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"A list of WebIds for all the people this user knows."}}]}]}},{"id":"https://shaperepo.com/schemas/solidProfile#TrustedAppShape","expression":{"expressions":[{"predicate":"http://www.w3.org/ns/auth/acl#mode","valueExpr":{"values":["http://www.w3.org/ns/auth/acl#Append","http://www.w3.org/ns/auth/acl#Control","http://www.w3.org/ns/auth/acl#Read","http://www.w3.org/ns/auth/acl#Write"]},"min":1,"max":-1,"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The level of access provided to this origin"}}]},{"predicate":"http://www.w3.org/ns/auth/acl#origin","valueExpr":{},"annotations":[{"predicate":"http://www.w3.org/2000/01/rdf-schema#comment","object":{"value":"The app origin the user trusts"}}]}]}}]}'
    );
  });

  it("works with Activity Pub", async () => {
    await ShexJStringTransformer.transform(
      await jsonld2graphobject({ "@id": "SCHEMA", ...activityPub }, "SCHEMA"),
      "Schema",
      undefined
    );
    // Expect it not to error
    expect(true).toBe(true);
  });
});
